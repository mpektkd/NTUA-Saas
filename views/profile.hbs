<div id="wrapper">
    <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0">
        <div class="container-fluid d-flex flex-column p-0"><a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
            <div class="sidebar-brand-icon rotate-n-15"><i class="fas fa-laugh-wink"></i></div>
            <div class="sidebar-brand-text mx-3 text-wrap"><span>Ask Me Anything!</span></div>
        </a>
            <hr class="sidebar-divider my-0">
            <ul class="navbar-nav text-light" id="accordionSidebar">
                <li class="nav-item"><a class="nav-link" href="/"><i class="fas fa-tachometer-alt"></i><span>Home</span></a></li>
                <li class="nav-item"><a class="nav-link active" href="/profile"><i class="fas fa-user"></i><span>Profile</span></a></li>
                <li class="nav-item"><a class="nav-link" href="/logout"><i class="far fa-user-circle"></i><span>Logout</span></a></li>
            </ul>
            <div class="text-center d-none d-md-inline"><button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button></div>
        </div>
    </nav>
    <div class="d-flex flex-column" id="content-wrapper">
        <div id="content">
            <div class="container-fluid">
                <div class="row mb-3">
                    <div class="col-lg-4">
                        <div class="card mb-3">
                            <div class="card-body text-center shadow">
                                <img id="avatar" alt="Avatar" class="rounded-circle mb-3 mt-4">
                                <div class="mb-3">
                                    <button class="btn btn-primary btn-sm" type="button">Change Photo</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-8">
                        <div class="row">
                            <div class="col">
                                <div class="card mb-3">
                                    <div class="card-header py-3">
                                        <p class="text-primary m-0 fw-bold">User Info</p>
                                    </div>
                                    <div class="row">
                                        <div class="col-3 d-flex justify-content-center">
                                            <div class="mb-3">
                                                <label class="form-label" for="username">
                                                    <strong>Username</strong>
                                                </label>
                                                <p>{{profile.user.username}}</p>
                                            </div>
                                        </div>
                                        <div class="col-2"></div>
                                        <div class="col-3">
                                            <div class="mb-3">
                                                <label class="form-label" for="email">
                                                    <strong>Email Address</strong>
                                                </label>
                                                <p>{{profile.user.email}}</p>
                                            </div>
                                        </div>
                                        <div class="col-4"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container-fluid">
                    <div class="row mb-3">
                        <div class="col-lg-7">
                            <div class="card mb-3">
                                <div class="card-header py-3">
                                    <h6 class="text-primary fw-bold m-0">Contribution per Day</h6>
                                </div>
                                <div class="card-body text-center shadow">
                                    <canvas id="line-chart" width="800" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-5">
                            <div class="row">
                                <div class="col">
                                    <div class="card mb-3">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">User Settings</p>
                                        </div>
                                        <div class="card-body">
                                            <form action="/user/update" method="POST">
                                                <input type="hidden" name="hidden_username" value="{{profile.user.username}}">
                                                <input type="hidden" name="hidden_email" value="{{profile.user.email}}">
                                                <input type="hidden" name="hidden_password" value="{{profile.user.password}}">
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="mb-3">
                                                            <label class="form-label" for="username">
                                                                <strong>Username</strong>
                                                            </label>
                                                            <input class="form-control" type="text" id="username" placeholder="user.name" name="username">
                                                        </div>
                                                    </div>
                                                    <div class="col">
                                                        <div class="mb-3">
                                                            <label class="form-label" for="email">
                                                                <strong>Email Address</strong>
                                                            </label>
                                                            <input class="form-control" type="email" id="email" placeholder="user@example.com" name="email"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="mb-3">
                                                            <label class="form-label" for="password">
                                                                <strong>Password</strong>
                                                            </label>
                                                            <input class="form-control" type="password" id="password" name="password">
                                                        </div>
                                                    </div>
                                                    <div class="col"></div>
                                                </div>
                                                <div class="mb-3">
                                                    <button class="btn btn-primary btn-sm" type="submit">Save Settings</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-lg-6">
                            <div class="row">
                                <div class="col">
                                    <div class="card shadow mb-3">
                                        <div class="card-header py-3">
                                            <h4 class="text-primary m-0 fw-bold">My Threads</h4>
                                        </div>
                                        <div class="card shadow">
                                            <div class="card-header py-3">
                                                <p class="text-primary m-0 fw-bold">Questions Info</p>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6 text-nowrap">
                                                    </div>
                                                    <div class="table-responsive table mt-2" role="grid" aria-describedby="dataTable_info">
                                                        <table class="table my-0" id="questionTable">
                                                            <thead>
                                                            <tr>
                                                                <th>Title</th>
                                                                <th></th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            </tbody>
                                                            <tfoot>
                                                            <tr>
                                                                <td><strong>Name</strong></td>
                                                                <td><strong>Position</strong></td>
                                                            </tr>
                                                            </tfoot>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="row">
                                <div class="col">
                                    <div class="card shadow mb-3">
                                        <div class="card-header py-3">
                                            <h4 class="text-primary m-0 fw-bold">Threads</h4>
                                        </div>
                                        <div class="card shadow">
                                            <div class="card-header py-3">
                                                <p class="text-primary m-0 fw-bold">Answers Info</p>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6 text-nowrap">
                                                    </div>
                                                    <div class="table-responsive table mt-2" role="grid" aria-describedby="dataTable_info">
                                                        <table class="table my-0" id="answerTable">
                                                            <thead>
                                                            <tr>
                                                                <th>Title</th>
                                                                <th></th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            </tbody>
                                                            <tfoot>
                                                            <tr>
                                                                <td><strong>Name</strong></td>
                                                                <td><strong>Position</strong></td>
                                                            </tr>
                                                            </tfoot>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script >
    $('document').ready(function(){
        let chartData = {};
        let labels = [];
        let data;
        let values = [];

        function respondCanvas() {
            let c = $('#line-chart');
            let ctx = c.get(0).getContext("2d");
            let container = c.parent();
            let $container = $(container);

            c.attr('width', $container.width()); //max width
            c.attr('height', $container.height()); //max height

            //Call a function to redraw other content (texts, images etc)
            let chart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    title: {
                        display: true,
                        text: 'Contribution per Day'
                    },
                    scales: {
                        yAxes: [{
                            display: true,
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        }
        let GetChartData = function () {
            data ={{{json profile.contr}}};
            data.map(x => values.push(x.total) && labels.push(new Date(Date.parse(x.datecontr)).toUTCString().slice(6,16)));
            console.log(values);
            console.log(labels);
            chartData = {
                labels: labels,
                datasets: [
                    {
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(255, 159, 64, 0.2)',
                            'rgba(255, 205, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(201, 203, 207, 0.2)'
                        ],
                        borderColor: [
                            'rgb(255, 99, 132)',
                            'rgb(255, 159, 64)',
                            'rgb(255, 205, 86)',
                            'rgb(75, 192, 192)',
                            'rgb(54, 162, 235)',
                            'rgb(153, 102, 255)',
                            'rgb(201, 203, 207)'
                        ],
                        borderWidth: 1,
                        label: 'My Contribution',
                        fill: false,
                        data: values
                    }
                ]
            };
            respondCanvas();
        };

        $(document).ready(function() {
            $(window).resize(respondCanvas);

            GetChartData();
        });
    });


</script>
<script type="text/javascript">
    $(document).ready(function(){
        let initials = ({{{json profile.user.username}}});
        document.getElementById("avatar").src = generateAvatar(initials[0], "white", "#009578");

        let values ={{{json profile.user.threadsOwned}}};
        let questionTableTable = $('#questionTable').DataTable({
            'data':  values.map(x => { return { id: x.id, title: x.title } }),
            'columns': [
                { data: 'title'},
                { data: 'id' ,
                'render': function(data, row, type, meta){
                    return '<form action="../answer/answer-form" method="POST">' +
                                '<input type="hidden" value="' + data + '" name="questionId">' +
                                '<input type="hidden" value="true" name="fromProfile">' +
                                '<button class="submitAnswer btn btn-primary btn-sm" type="submit">See Question</button>' +
                            '</form>'
                }},

        ]
        });

        $('#searchByName').keyup(function(){
            questionTableTable.draw();
        });

        $('#searchByGender').change(function(){
            questionTableTable.draw();
        });

        values ={{{json profile.user.threads}}};
        let answerTable = $('#answerTable').DataTable({
            'data':  values.map(x => { return { id: x.id, title: x.title } }),
            'columns': [
                { data: 'title' },
                { data: 'id' ,
                    'render': function(data, row, type, meta){
                        return '<form action="../answer/answer-form" method="POST">' +
                                '<input type="hidden" value="' + data + '" name="questionId">' +
                                '<input type="hidden" value="true" name="fromProfile">' +
                                '<button class="submitAnswer btn btn-primary btn-sm" type="submit">See Answer</button>' +
                                '</form>'
                    }},

            ]
        });
    });
</script>
<script>
    function generateAvatar(text, foregroundColor, backgroundColor) {
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");

        canvas.width = 200;
        canvas.height = 200;

        // Draw background
        context.fillStyle = backgroundColor;
        context.fillRect(0, 0, canvas.width, canvas.height);

        // Draw text
        context.font = "bold 100px Assistant";
        context.fillStyle = foregroundColor;
        context.textAlign = "center";
        context.textBaseline = "middle";
        context.fillText(text, canvas.width / 2, canvas.height / 2);

        return canvas.toDataURL("image/png");
    }
</script>
